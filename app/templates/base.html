{% extends "bootstrap/base.html" %}

{% block title %}–õ—ç—Ç—É–∞–ª—å{% endblock %}

{% block head %}
{{ super() }}
<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='labb1.css') }}">
{% endblock %}

{% block navbar %}


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="modal-body">
            <img id="modalImage" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
            <h3 id="modalName"></h3>
            <p id="modalDescription"></p>
            <p><strong>–¶–µ–Ω–∞:</strong> <span id="modalPrice"></span></p>
            {% if current_user.is_authenticated %}
            <div class="cart-controls">
            {% else %}
            <div class="cart-controls hidden">
            {% endif %}

                
                <button id="decreaseQuantity">-</button>
                <span id="quantity">1</span>
                <button id="increaseQuantity">+</button>
                <button id="addToCart">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>

            </div>
            
        </div>
    </div>
</div>

<div class="indent-left">
    <header>
        <div class="header-left">
            <div class="logo">
                <a href="https://www.letu.ru/product/nars-stoikii-tonalnyi-krem-natural-radiant-longwear-foundation/62200016">
                    <img src="https://avatars.mds.yandex.net/i?id=f221b1d597aba9161ea8e04fd40a5bc9d26e2ce1-7662207-images-thumbs&n=13"
                    style="float: left;
                    margin-left: 0px;
                
                    width: 70%;
                    height: 107px;"
                    alt="NARS –°—Ç–æ–π–∫–∏–π —Ç–æ–Ω–∞–ª—å–Ω—ã–π –∫—Ä–µ–º Natural Radiant Longwear Foundation"></a>
            </div>
            
        </div>
        <div class="header-center">
            <h1 ><a style="color: black;" href="{{ url_for('main.index') }}">–õ—ç—Ç—É–∞–ª—å</a></h1>
        </div>

        <ul class="nav navbar-nav">
            {% if current_user.can(Permission.MODERATE) %}
            <li><a href="{{ url_for('main.moderate') }}">Moderate Comments</a></li>
            {% endif %}
            {% if current_user.is_authenticated %}
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    <img src="{{ current_user.gravatar(size=18) }}">
                    –ê–∫–∫–∞—É–Ω—Ç <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                    <li><a style="color: black;" href="{{ url_for('auth.change_password') }}">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</a></li>
                    <li><a style="color: black;" href="{{ url_for('auth.change_email_request') }}">–°–º–µ–Ω–∏—Ç—å –ø–æ—á—Ç—É</a></li>
                    <li><a style="color: black;" href="{{ url_for('auth.logout') }}">–í—ã–π—Ç–∏</a></li>
                </ul>
            </li>
            {% else %}
            <li><a style="color: black;" href="{{ url_for('auth.login') }}">–í–æ–π—Ç–∏ </a></li>
            {% endif %}
        </ul>
    </header>
    <!-- –ü–æ–ª–æ—Å–∞ —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
    <nav class="sections-bar">
        <a style="text-decoration: underline;" href="/laba1">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</a>
        {% if current_user.is_authenticated %}
        <a style="text-decoration: underline;" href="{{ url_for('main.user', username=current_user.username) }}">–ü—Ä–æ—Ñ–∏–ª—å</a>
        {% endif %}
        <a style="text-decoration: underline;" href="/feedback">–û—Ç–∑—ã–≤—ã</a>
    </nav>
    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∞–π—Ç–∞ -->
    <div class="container">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <aside class="sidebar">
            <ul>
                <!-- <form action="laba1/page1" method="post" enctype="multipart/form-data"> -->
                <li ><a style="color: rgb(0, 0, 255); text-decoration: underline;" href="/laba1/about_us" >–û –Ω–∞—Å</a></li>
                <li><a style="color: rgb(0, 0, 255); text-decoration: underline;" href="/laba1/services">–¢–æ–≤–∞—Ä—ã</a></li>
                <li><a style="color: rgb(0, 0, 255); text-decoration: underline;" href="/laba1/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                <li><a style="color: rgb(0, 0, 255); text-decoration: underline;" href="/laba1/employees">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a></li>
                
            </ul>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main>
            {% block content %}
            <div class="container" style="flex-direction: column;">
                {% for message in get_flashed_messages() %}
                <div class="alert alert-warning">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    {{ message }}
                </div>
                {% endfor %}

                
            </div>
            
            {% endblock %}   
            {% block page_content %}{% endblock %}   
            {% block main %}
            {% endblock %}
        </main>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        {% if current_user.is_authenticated %}
            <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ—Ä–∑–∏–Ω—ã -->
            <button id="cartButton" class="cart-button " onclick="opencorzina()">
                üõí
            </button>

            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã -->
            <div id="cartModal" class="cart-modal hidden">
                <div class="cart-content">
                    <button id="closeCart" class="close-button" onclick="closecorzina()">‚úñ</button>
                    <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
                    <div id="cartContainer">
                        <p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                    </div>
                </div>
            </div>
        {% endif %}

        <aside class="right-sidebar">
            {% if false %}

            {% else %}
            <div class="images">
                <a href="https://a2company.ru/a2about">
                    <img src="https://avatars.mds.yandex.net/i?id=c6f4e4a6df86765802ff2b305bb65246_l-5141542-images-thumbs&n=13" alt="NARS –°—Ç–æ–π–∫–∏–π —Ç–æ–Ω–∞–ª—å–Ω—ã–π –∫—Ä–µ–º Natural Radiant Longwear Foundation">
                    A&A ‚Äì –±–µ—Å—Å–ø–æ—Ä–Ω—ã–π –ª–∏–¥–µ—Ä –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ñ–∏—Ç–Ω–µ—Å –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –†–æ—Å—Å–∏–∏.</a>
                <a href="https://iconproducts.com">
                    <img src="https://avatars.mds.yandex.net/i?id=b324038c0dc709fd260dc4c9276a5d4e5527c0ca-5232271-images-thumbs&n=13">
                    I.C.O.N. ‚Äì –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è, —Å–æ–∑–¥–∞—é—â–∞—è –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è —É—Ö–æ–¥–∞ –∑–∞ –≤–æ–ª–æ—Å–∞–º–∏.</a>
                <a href="https://cacharel.ru.com">
                    <img src="https://avatars.mds.yandex.net/i?id=68436fe1580f3472f2e9b1728ecb5dfb_l-10194750-images-thumbs&n=13" alt="NARCISO RODRIGUEZ NARCISO eau de parfum Grace">
                    Cacharel ‚Äì —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –±—Ä–µ–Ω–¥, –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä–æ–º–∞—Ç–∞–º–∏ Ana√Øs Ana√Øs, Amor Amor –∏ Noa —Å —è—Ä–∫–∏–º–∏ —Ü–≤–µ—Ç–æ—á–Ω—ã–º–∏ –∏ —Ñ—Ä—É–∫—Ç–æ–≤—ã–º–∏ –Ω–æ—Ç–∞–º–∏.</a>
            </div>
            {% endif %}

        </aside>
        <!-- –§—É—Ç–µ—Ä -->
        <footer class="footer">
            <p>¬© 2024 –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. <a href='–ü–æ–ª–∏—Ç–∏–∫–∞_–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.pdf' target="_blank"> –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a></p>
        </footer>
    </div>
</div>

{% endblock %}



{% block scripts %}

<script>

    function opencorzina(){
        document.getElementById('cartModal').classList.remove('hidden');
         
    }
    function closecorzina(){
        document.getElementById('cartModal').classList.add('hidden');
         
    }


        function openPDF() {
            const filePath = "file:///C:/Users/89169/Downloads/–ü–æ–ª–∏—Ç–∏–∫–∞%20–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.pdf";
            window.open(filePath, "_blank");
        }


document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('productModal');
    const closeModal = document.querySelector('.close');
    const productLinks = document.querySelectorAll('.product-link');


    const modalImage = document.getElementById('modalImage');
    const modalName = document.getElementById('modalName');
    const modalDescription = document.getElementById('modalDescription');
    const modalPrice = document.getElementById('modalPrice');
    const quantityEl = document.getElementById('quantity');
    let quantity = 1;


    const cartContainer = document.getElementById('cartContainer');
    let cart = [];


    productLinks.forEach(link => {
        link.addEventListener('click', function (e) {
            e.preventDefault();
            modalImage.src = this.dataset.image;
            modalName.textContent = this.dataset.name;
            modalDescription.textContent = this.dataset.description;
            modalPrice.textContent = this.dataset.price;

            quantity = 1;
            quantityEl.textContent = quantity;

            modal.style.display = 'block';
        });
    });


    closeModal.addEventListener('click', function () {
        modal.style.display = 'none';
    });


    document.getElementById('decreaseQuantity').addEventListener('click', function () {
        if (quantity > 1) {
            quantity--;
            quantityEl.textContent = quantity;
        }
    });

    document.getElementById('increaseQuantity').addEventListener('click', function () {
        quantity++;
        quantityEl.textContent = quantity;
    });


    async function fetchCart() {
        const response = await fetch('/cart');
        cart = await response.json();
        updateCartUI();
    }


    async function addToCart(productName, quantity, price) {
        const response = await fetch('/cart', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ product_name: productName, quantity, price })
        });
        const newItem = await response.json();
        const existing = cart.find(item => item.id === newItem.id);
        if (existing) {
            existing.quantity = newItem.quantity;
        } else {
            cart.push(newItem);
        }
        updateCartUI();
    }


    async function updateCartItem(itemId, quantity) {
        await fetch(`/cart/${itemId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ quantity })
        });
        const item = cart.find(item => item.id === itemId);
        if (item) item.quantity = quantity;
        updateCartUI();
    }


    async function deleteCartItem(itemId) {
        await fetch(`/cart/${itemId}`, { method: 'DELETE' });
        cart = cart.filter(item => item.id !== itemId);
        updateCartUI();
    }


    function updateCartUI() {
        cartContainer.innerHTML = '';
        let totalAmount = 0;

        if (cart.length === 0) {
            cartContainer.innerHTML = '<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
            return;
        }

        cart.forEach(item => {
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `
                <span>${item.product_name} - ${item.quantity} —à—Ç. (${item.price} ‚ÇΩ)</span>
                <button class="decrease-item" data-id="${item.id}">-</button>
                <button class="increase-item" data-id="${item.id}">+</button>
                <button class="remove-item" data-id="${item.id}">–£–¥–∞–ª–∏—Ç—å</button>
            `;
            cartContainer.appendChild(div);

            totalAmount += item.price * item.quantity;

            div.querySelector('.decrease-item').addEventListener('click', () => {
                if (item.quantity > 1) {
                    updateCartItem(item.id, item.quantity - 1);
                } else {
                    deleteCartItem(item.id);
                }
            });

            div.querySelector('.increase-item').addEventListener('click', () => {
                updateCartItem(item.id, item.quantity + 1);
            });

            div.querySelector('.remove-item').addEventListener('click', () => {
                deleteCartItem(item.id);
            });
        });

        const totalDiv = document.createElement('div');
        totalDiv.className = 'cart-total';
        totalDiv.innerHTML = `<p>–û–±—â–∞—è —Å—É–º–º–∞: ${totalAmount.toFixed(2)} ‚ÇΩ</p>`;
        cartContainer.appendChild(totalDiv);
    }


    document.getElementById('addToCart').addEventListener('click', function () {
        const productName = modalName.textContent;
        const productPrice = parseFloat(modalPrice.textContent.replace('‚ÇΩ', '').trim());
        addToCart(productName, quantity, productPrice);
        modal.style.display = 'none';
    });


    window.addEventListener('click', function (e) {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });


    fetchCart();
});

</script>

<script>
function submitLogin() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const rememberMe = document.getElementById('remember_me').checked;

    if (!email || !password) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.");
        return;
    }

    try {
        const response = fetch('/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json', // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            },
            body: JSON.stringify({
                email: email,
                password: password,
                remember_me: rememberMe // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞
            })
        });
        
        // if (response.ok) {
        //     const result = response.json();
        //     alert(result.message || "–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏!");
        //     window.location.href = "/";
        // } else {
        //     const error = response.json();
        //     alert(error.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.");
        // }
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞:", error);
        alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
    }
}
</script>
{{ super() }}
{{ moment.include_moment() }}
{% endblock %}
